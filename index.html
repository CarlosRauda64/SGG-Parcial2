<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcards SIG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos para la animación de volteo */
        .flashcard {
            backface-visibility: hidden;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }
        .flashcard-container.flipped .flashcard-front {
            transform: rotateY(180deg);
        }
        .flashcard-container.flipped .flashcard-back {
            transform: rotateY(0deg);
        }
        .flashcard-back {
            transform: rotateY(-180deg);
        }
        /* Clase para ocultar/mostrar vistas */
        .view-hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans flex flex-col min-h-screen">

    <header class="bg-blue-600 text-white p-4 shadow-md">
        <h1 class="text-2xl font-bold text-center">Estudio de Flashcards SIG</h1>
    </header>

    <nav class="bg-blue-500 p-2 flex justify-center space-x-4 shadow">
        <button id="btn-view-study" class="text-white hover:bg-blue-700 px-3 py-1 rounded transition duration-200">Estudiar</button>
        <button id="btn-view-piles" class="text-white hover:bg-blue-700 px-3 py-1 rounded transition duration-200">Pilas</button>
        <button id="btn-view-all" class="text-white hover:bg-blue-700 px-3 py-1 rounded transition duration-200">Todas</button>
    </nav>

    <main class="flex-grow container mx-auto p-4 md:p-6 lg:p-8">

        <section id="view-study" class="">
            <div id="study-area" class="bg-white p-6 rounded-lg shadow-lg max-w-xl mx-auto text-center">
                <p id="progress-counter" class="text-sm text-gray-500 mb-4">Tarjeta X de Y</p>
                <div id="flashcard-container" class="flashcard-container perspective-[1000px] h-64 mb-6">
                    <div class="relative w-full h-full">
                        <div id="flashcard-front" class="flashcard absolute w-full h-full bg-blue-100 border border-blue-300 rounded-lg shadow p-4 flex items-center justify-center">
                            <p id="card-question" class="text-lg md:text-xl"></p>
                        </div>
                        <div id="flashcard-back" class="flashcard absolute w-full h-full bg-green-100 border border-green-300 rounded-lg shadow p-4 flex items-center justify-center overflow-auto">
                            <p id="card-answer" class="text-base md:text-lg"></p>
                        </div>
                    </div>
                </div>

                <div class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4">
                    <button id="btn-not-learned" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow w-full sm:w-auto">
                        No aprendido
                    </button>
                    <button id="btn-almost" class="bg-yellow-500 hover:bg-yellow-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow w-full sm:w-auto">
                        Casi casi
                    </button>
                    <button id="btn-learned" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow w-full sm:w-auto">
                        Aprendido
                    </button>
                </div>
                 <p id="study-complete-message" class="mt-6 text-green-700 font-semibold text-xl view-hidden">¡Felicidades! Has completado todas las tarjetas.</p>
                 <p id="loading-error-message" class="mt-6 text-red-700 font-semibold text-xl view-hidden">Error al cargar las tarjetas.</p> </div>
        </section>

        <section id="view-piles" class="view-hidden">
            <div class="bg-white p-6 rounded-lg shadow-lg max-w-md mx-auto text-center">
                <h2 class="text-xl font-semibold mb-4">Estado de las Pilas</h2>
                <div class="space-y-3">
                    <div class="bg-blue-100 p-3 rounded">Por Aprender: <span id="pile-to-learn-count" class="font-bold">0</span></div>
                    <div class="bg-yellow-100 p-3 rounded">Casi Aprendido: <span id="pile-almost-count" class="font-bold">0</span></div>
                    <div class="bg-green-100 p-3 rounded">Aprendido: <span id="pile-learned-count" class="font-bold">0</span></div>
                </div>
                 <button id="btn-reset-progress" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200 shadow">
                    Reiniciar Progreso
                </button>
            </div>
        </section>

        <section id="view-all" class="view-hidden">
             <div class="bg-white p-4 md:p-6 rounded-lg shadow-lg max-w-4xl mx-auto">
                <h2 class="text-xl font-semibold mb-4 text-center">Todas las Tarjetas</h2>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">#</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unidad</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pregunta</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Respuesta</th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                            </tr>
                        </thead>
                        <tbody id="all-cards-table-body" class="bg-white divide-y divide-gray-200">
                            </tbody>
                    </table>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-200 text-center text-sm text-gray-600 p-3 mt-8">
        Aplicación de Flashcards
    </footer>

    <script>
        // --- Datos de Flashcards (Incrustados) ---
        // Estos datos provienen del archivo JSON que generamos anteriormente
        const flashcardsData = [
          { "unidad": "III-B", "pregunta": "¿Cuál era la principal fuente de datos para los SIG en sus inicios y qué proceso era necesario?", "respuesta": "La principal fuente era la cartografía en papel. Era necesaria la digitalización para convertir los datos impresos a formato digital manejable por un SIG." },
          { "unidad": "III-B", "pregunta": "¿Qué condiciona la forma en que los datos geográficos llegan a nosotros y el uso que les podemos dar en un SIG?", "respuesta": "La metodología seguida en la recolección de los datos geográficos condiciona directamente su forma y, por tanto, su uso o las operaciones necesarias para adaptarlos." },
          { "unidad": "III-B", "pregunta": "Define datos geográficos digitales y analógicos.", "respuesta": "Digitales: Valores numéricos que alimentan una aplicación informática (SIG). Analógicos: Datos en formatos no digitales (mapas, fotos aéreas impresas, etc.)." },
          { "unidad": "III-B", "pregunta": "Menciona las 5 ventajas principales de los datos digitales sobre los analógicos.", "respuesta": "1. Sencillez de actualización. 2. Facilidad de distribución. 3. Menor espacio de almacenamiento. 4. Mayor facilidad y precisión de análisis. 5. Facilidad de mantenimiento." },
          { "unidad": "III-B", "pregunta": "Explica la diferencia entre fuentes primarias y secundarias de datos espaciales.", "respuesta": "Primarias: Datos que ya son utilizables en un SIG en su forma original (ej. imágenes digitales, GPS). Secundarias: Datos derivados de otros previos no adecuados directamente para SIG (ej. mapas digitalizados, levantamientos tradicionales)." },
          { "unidad": "III-B", "pregunta": "¿Qué es la teledetección?", "respuesta": "Es el estudio y medida de las características de objetos (superficie terrestre) sin contacto físico, midiendo las perturbaciones (principalmente electromagnéticas) que provocan en su entorno." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son los 4 elementos del proceso de teledetección?", "respuesta": "1. Fuente de radiación (A). 2. Objetos que interaccionan/emiten radiación (B). 3. Atmósfera por donde viaja la radiación (C). 4. Receptor que recoge la radiación y genera una imagen (capa ráster) (D)." },
          { "unidad": "III-B", "pregunta": "¿Qué son los Niveles Digitales en teledetección?", "respuesta": "Son valores enteros (usualmente 1-256) en las celdas de una imagen de teledetección que indican la intensidad de la radiación recibida." },
          { "unidad": "III-B", "pregunta": "Define sensor y plataforma en teledetección.", "respuesta": "Sensor: Elemento que 'lee' la radiación electromagnética y registra su intensidad (ej. cámara, sensor multiespectral). Plataforma: Medio donde se sitúa el sensor (ej. avión, satélite)." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son las ventajas y desventajas de usar aviones como plataformas de teledetección?", "respuesta": "Ventajas: Mayor disponibilidad (se puede elegir cómo, cuándo, dónde volar). Desventajas: Inestabilidad, dependencia del clima, menor cobertura superficial que los satélites." },
          { "unidad": "III-B", "pregunta": "¿Qué es la digitalización y qué tipos principales existen?", "respuesta": "Es el proceso de obtener un producto digital a partir de cartografía impresa (fuente secundaria). Tipos: Automática (escaneo, vectorización automática) y Manual (con tableta digitalizadora o en pantalla 'heads-up')." },
          { "unidad": "III-B", "pregunta": "Compara ventajas y desventajas de la digitalización manual vs. automática (vectorial).", "respuesta": "Manual: Más costosa, precisión variable (depende del operario), pero reconocimiento fiable y permite corregir errores del original. Automática: Más rápida, precisión potencialmente alta ('clona' el original), pero no corrige errores y puede requerir mucha corrección posterior si el original no es ideal." },
          { "unidad": "III-B", "pregunta": "¿Qué es una tableta digitalizadora?", "respuesta": "Es la herramienta tradicional fundamental para la digitalización manual vectorial, permitiendo trazar entidades sobre un mapa impreso fijado a ella." },
          { "unidad": "III-B", "pregunta": "¿Qué es la digitalización en pantalla o 'heads-up'?", "respuesta": "Es la digitalización manual vectorial usando las herramientas de edición de un SIG para 'dibujar' entidades sobre una capa base digital (imagen escaneada, foto aérea digital, etc.) visualizada en la pantalla." },
          { "unidad": "III-B", "pregunta": "¿Qué es el escaneo y qué dispositivo utiliza?", "respuesta": "Es el proceso de digitalización automática que convierte una imagen impresa en una imagen digital (capa ráster). Utiliza un escáner." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son los parámetros básicos de un escáner?", "respuesta": "Resolución espacial (puntos por pulgada - ppp) y resolución radiométrica (capacidad de distinguir colores)." },
          { "unidad": "III-B", "pregunta": "¿Qué es la vectorización automática?", "respuesta": "Es un proceso que obtiene una capa vectorial a partir de cartografía impresa (o una imagen digital de esta) sin que el operario trace manualmente las entidades, mediante reconocimiento de patrones." },
          { "unidad": "III-B", "pregunta": "¿Qué es la geocodificación y un ejemplo común?", "respuesta": "Es la asignación de coordenadas a puntos de interés a partir de información alfanumérica (sin un mapa gráfico previo). Ejemplo: asignar coordenadas a direcciones postales." },
          { "unidad": "III-B", "pregunta": "¿Qué es la fotogrametría?", "respuesta": "Es la técnica para estudiar y definir con precisión la forma, dimensiones y posición de un objeto usando medidas sobre fotografías (aéreas en el contexto SIG)." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son los tipos de fotogrametría según su evolución?", "respuesta": "Analógica (imágenes analógicas), Analítica (formulaciones matemáticas y computación) y Digital (imágenes digitales en entorno computarizado)." },
          { "unidad": "III-B", "pregunta": "¿Qué es un GNSS y cuál es el más conocido?", "respuesta": "GNSS (Sistemas Globales de Navegación por Satélite) permite conocer la localización exacta en cualquier punto del globo. El más conocido es el GPS (Sistema de Posicionamiento Global)." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son los tres segmentos del sistema GPS?", "respuesta": "1. Segmento espacial (satélites). 2. Segmento de control (estaciones terrestres). 3. Segmento de usuarios (receptores GPS)." },
          { "unidad": "III-B", "pregunta": "¿En qué se basa el cálculo de posición del GPS y qué sistema de referencia usa?", "respuesta": "Se basa en la triangulación de la posición (x, y, z) mediante señales y distancias a varios satélites. Utiliza el sistema geodésico WGS84." },
          { "unidad": "III-B", "pregunta": "Menciona algunas fuentes de error en el sistema GPS.", "respuesta": "Errores en posición de satélites, rebote de señal (multitrayectoria), paso por la atmósfera (ionosfera, troposfera), precisión de relojes, disponibilidad selectiva (eliminada en 2000)." },
          { "unidad": "III-B", "pregunta": "Describe los tipos principales de receptores GPS según su uso.", "respuesta": "1. Uso general (bajo coste, portátiles, para ocio, navegación). 2. Medición topográfica (mayor precisión, antena externa, uso profesional SIG). 3. Medición del tiempo (fijos, alta precisión temporal)." },
          { "unidad": "III-B", "pregunta": "¿Cómo se integra el GPS con los SIG?", "respuesta": "Como fuente de datos estática (crear capas a partir de datos de campo) o para obtención de datos en tiempo real (SIG móviles). Permite capturar componente espacial y, a menudo, temática (atributos)." },
          { "unidad": "III-B", "pregunta": "¿Qué es la Información Geográfica Voluntaria (VGI) o Participativa?", "respuesta": "Es el uso de Internet para crear, gestionar y difundir información geográfica aportada voluntariamente por usuarios (neogeografía), democratizando la creación cartográfica." },
          { "unidad": "III-B", "pregunta": "¿Cuáles son algunas críticas o problemas asociados a la VGI?", "respuesta": "La calidad de la información puede ser variable al provenir de no expertos y usar equipo de bajo coste, aunque para ciertos tipos de datos (ej. puntos de interés) puede ser suficiente." },
          { "unidad": "III-B", "pregunta": "¿Por qué es importante la cartografía de elevaciones en SIG?", "respuesta": "Porque casi todos los procesos estudiados en SIG tienen relación con el relieve, y una capa de elevación aporta amplia información sobre ellos." },
          { "unidad": "III-B", "pregunta": "Enumera las metodologías mencionadas para obtener cartografía de elevaciones.", "respuesta": "GPS, Digitalización de curvas de nivel, Estereografía, Interferometría (Radar, SRTM), LIDAR." },
          { "unidad": "III-B", "pregunta": "¿Qué es un archivo 'World File' y para qué sirve?", "respuesta": "Es un pequeño archivo de texto plano que acompaña a un archivo de imagen y contiene los datos de georreferencia (tamaño de píxel, coordenadas de esquina, rotación) para que el SIG pueda ubicarla espacialmente. Su extensión se forma con la primera y última letra de la extensión de la imagen + 'w' (ej. .tfw para .tif)." },
          { "unidad": "III-B", "pregunta": "Explica la diferencia entre compresión con pérdidas y sin pérdidas en imágenes.", "respuesta": "Sin pérdidas: Recupera la imagen exacta, sin degradación (ej. Run-Length). Con pérdidas: Pierde información para lograr mayor compresión, la imagen resultante es similar pero no idéntica (ej. JPEG, ECW)." },
          { "unidad": "III-B", "pregunta": "¿Qué formato ráster común soporta una única banda y valor 'sin datos' en ASCII?", "respuesta": "ArcInfo ASCII (.asc)." },
          { "unidad": "III-B", "pregunta": "Describe brevemente el formato TIFF/GeoTIFF.", "respuesta": "TIFF (.tif): Formato flexible, muchas variantes, puede usar compresión con/sin pérdidas, apto para imágenes y otros datos ráster (valores decimales). GeoTIFF: Variante que incluye georreferencia en el propio archivo." },
          { "unidad": "III-B", "pregunta": "Describe brevemente los formatos ECW y MrSID.", "respuesta": "ECW (.ecw): Compresión con pérdidas, optimizado para imágenes grandes (aéreas/satélite), permite descompresión selectiva. MrSID (.sid): Similar a ECW (alta compresión, para imágenes grandes, descompresión selectiva) pero es un formato cerrado." },
          { "unidad": "III-B", "pregunta": "¿Qué dos aspectos principales diferencian los formatos de archivo vectoriales?", "respuesta": "1. Capacidad para recoger la topología de la capa. 2. Capacidad para recoger los atributos temáticos de las entidades (limitada en formatos CAD)." },
          { "unidad": "III-B", "pregunta": "Describe brevemente el formato Shapefile (.shp).", "respuesta": "Propuesto por ESRI, estándar de facto. No soporta topología directamente. Se compone de varios archivos (.shp, .shx, .dbf, etc.) que almacenan geometría, índices, atributos." },
          { "unidad": "III-B", "pregunta": "Describe brevemente los formatos DWG y DXF.", "respuesta": "DWG: Formato nativo de AutoCAD (CAD), cerrado, almacena datos 2D/3D y metadatos. DXF: También de AutoCAD, especificaciones públicas, para interoperabilidad CAD, menos complejo que DWG, muy usado para cartografía." },
          { "unidad": "III-B", "pregunta": "¿Cómo se manejaban los datos en los SIG de primera generación?", "respuesta": "Mediante archivos con formatos cerrados, vinculados al software específico, sin un SGBD estructurado. El propio SIG gestionaba el acceso y edición." },
          { "unidad": "III-B", "pregunta": "Describe la arquitectura dual en los SIG de segunda generación.", "respuesta": "El SGBD relacional estándar gestionaba solo la componente temática. La componente espacial era gestionada por el propio SIG. Había dos subsistemas separados." },
          { "unidad": "III-B", "pregunta": "Describe la arquitectura en capas en los SIG de segunda generación y sus dos alternativas.", "respuesta": "Toda la información (espacial y temática) se almacenaba en un SGBD relacional estándar. Alternativas: 1. Almacenamiento transparente (usa tipos de datos y SQL del SGBD). 2. Almacenamiento opaco (usa objetos binarios, operaciones implementadas en el SIG)." },
          { "unidad": "III-B", "pregunta": "¿Cómo manejan los datos los SIG de tercera generación?", "respuesta": "Utilizan bases de datos con arquitecturas extensibles (orientadas a objetos o relacionales con extensiones espaciales como PostGIS, Oracle Spatial, etc.) que pueden definir y manejar tipos de datos espaciales y operaciones específicas de forma nativa y optimizada." },
          { "unidad": "III-B", "pregunta": "Menciona SGBD Open Source con soporte espacial.", "respuesta": "PostgreSQL + PostGIS, SQLite + SpatiaLite, MySQL (con funciones espaciales)." },
          { "unidad": "III-B", "pregunta": "Enumera las formas mencionadas para la captura de datos geográficos.", "respuesta": "Levantamientos fotogramétricos, imágenes de satélite, medidas GPS/Glonass/Galileo, Sensores, Levantamientos topográficos, Informes escritos/tablas/listas (con componente espacial)." },
          { "unidad": "IV-A", "pregunta": "¿Por qué se dice que los SIG son herramientas versátiles?", "respuesta": "Porque pueden adaptarse a circunstancias particulares de muchas disciplinas, utilizando prioritariamente distintas capacidades (análisis, visualización, manejo de datos) según las necesidades." },
          { "unidad": "IV-A", "pregunta": "¿Qué porcentaje estimado de bases de datos administrativas son susceptibles de ser georreferenciadas?", "respuesta": "Más del 80%." },
          { "unidad": "IV-A", "pregunta": "Menciona algunos factores para clasificar los ámbitos de aplicación de los SIG.", "respuesta": "Procesos de interés, tipo de datos, volumen de datos, precisión necesaria, tipo de usuarios, complejidad de operaciones, adecuación del SIG a las necesidades." },
          { "unidad": "IV-A", "pregunta": "Describe el rol del SIG como herramienta modelizadora.", "respuesta": "Permite modelizar realidades geográficas complejas combinando análisis sencillos en flujos de trabajo, adecuados para modelos conceptuales/matemáticos, estáticos/dinámicos." },
          { "unidad": "IV-A", "pregunta": "Describe el rol del SIG como herramienta para la toma de decisiones.", "respuesta": "Facilita combinar y visualizar globalmente múltiples variables (capas) para generar resultados que apoyen la interpretación de expertos y la toma de decisiones informadas." },
          { "unidad": "IV-A", "pregunta": "Describe el rol del SIG como herramienta para la difusión de información geográfica.", "respuesta": "Permite exponer datos geográficos de forma óptima a públicos amplios (incluyendo no técnicos vía web), añadiendo valor espacial a la información." },
          { "unidad": "IV-A", "pregunta": "Describe el rol del SIG como herramienta centralizadora.", "respuesta": "Actúa como sistema para gestionar y coordinar información geográfica y tareas de equipos en organizaciones (ej. SIG corporativo), donde la gestión de la base de datos es vital." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en la Gestión de Recursos Naturales.", "respuesta": "Campo pionero en SIG. Herramienta excepcional para gestionar y explotar gran cantidad de datos variados (vector/ráster) sobre recursos naturales, con fuerte componente de análisis." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en la Gestión de Riesgos.", "respuesta": "Análisis de distribución y probabilidad de riesgos (naturales/humanos). Uso principal de datos ráster (variables continuas) y vectoriales (registros de eventos). Usuarios avanzados." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en Ecología.", "respuesta": "Gestión de datos de campo, creación de cartografía, modelización de comportamientos y distribuciones espaciales (migraciones, dispersión). Uso de visualización y análisis." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en Negocios y Marketing.", "respuesta": "Análisis espacial para optimizar actividades de mercado: localización óptima, análisis de competencia, predicción de evolución, elaboración de informes y mapas comerciales." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en Ciencias Sociales.", "respuesta": "Estudio de relaciones humanas y comunitarias vinculadas al espacio. Uso de análisis espacial y geoestadística para extraer conclusiones y elaborar hipótesis." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en Planificación.", "respuesta": "Herramienta imprescindible para combinar múltiples factores y capas en la selección de emplazamientos óptimos, maximizando beneficios y minimizando impactos. Ayuda a la toma de decisiones." },
          { "unidad": "IV-A", "pregunta": "Describe brevemente la aplicación de SIG en el Ámbito Militar.", "respuesta": "Herramienta valiosa desde sus inicios por la importancia de la información espacial. Uso intensivo del análisis para estudio de alternativas y escenarios, pero también edición y cartografía." },
          { "unidad": "IV-A", "pregunta": "Menciona algunas áreas específicas de aplicación de SIG (más detalladas).", "respuesta": "Hidrografía, Jardinería, Agricultura (de precisión), Medio ambiente, Agraria, Geodesia/Topografía, Navegación/Transporte, Comunicación, Energía, Administración/Gestión (urbanística, servicios), Catastro, Planificación usos del suelo, Adm. Propiedades, Arqueología, Emergencias, Forestal, Turismo/Recreación, Seguimiento/Análisis, Salud, Educación, Seguridad." },
          { "unidad": "IV-A", "pregunta": "¿Qué es la Semiología Gráfica?", "respuesta": "Ciencia que estudia los sistemas de signos visuales (gráficos) y su significado, definiendo una 'gramática' para comprender cómo transmiten información (según Jacques Bertin)." },
          { "unidad": "IV-A", "pregunta": "Enumera las 7 variables visuales según Bertin.", "respuesta": "Posición, Tamaño, Forma, Textura, Tono (Color), Valor (Color), Orientación." },
          { "unidad": "IV-A", "pregunta": "¿Por qué la variable visual 'Posición' tiene un uso restringido en cartografía?", "respuesta": "Porque en un mapa, la posición del símbolo ya está determinada por la ubicación geográfica real del objeto que representa, no se puede alterar libremente para transmitir otra información." },
          { "unidad": "IV-A", "pregunta": "¿A qué tipo de símbolos se aplica fundamentalmente la variable 'Forma'?", "respuesta": "Principalmente a símbolos puntuales. Su aplicación a líneas es difícil y a superficies requiere alterar la forma del polígono (cartogramas) o usar un relleno con formas." },
          { "unidad": "IV-A", "pregunta": "¿Cómo se aplica la variable 'Tamaño' a símbolos puntuales, lineales y de superficie?", "respuesta": "Puntuales: Variando el tamaño del símbolo. Lineales: Variando el grosor de la línea. Superficies: Alterando el tamaño del polígono (cartogramas) o variando el tamaño de la trama en la textura de relleno." },
          { "unidad": "IV-A", "pregunta": "Define Tono, Valor y Saturación como componentes del color (espacio HSV).", "respuesta": "Tono (Hue): El color en sí (rojo, verde...). Valor (Value): Claridad/oscuridad del color. Saturación (Saturation): Pureza/intensidad del color (vs. grisáceo)." },
          { "unidad": "IV-A", "pregunta": "¿Qué componentes del color se usan principalmente como variables visuales en cartografía?", "respuesta": "El Tono y el Valor. La Saturación tiene un uso muy limitado." },
          { "unidad": "IV-A", "pregunta": "¿Cómo se aplica la variable 'Textura' a símbolos puntuales, lineales y de superficie?", "respuesta": "Puntuales: Relleno con un patrón (requiere tamaño suficiente). Lineales: Patrón de discontinuidad (guiones/espacios) o relleno si es gruesa (no recomendado). Superficies: Relleno con un patrón (uso más efectivo)." },
          { "unidad": "IV-A", "pregunta": "¿Cómo se aplica la variable 'Orientación'?", "respuesta": "Principalmente a símbolos puntuales no simétricos (formas geométricas). Puede aplicarse a texturas en líneas (si son anchas) o superficies." },
          { "unidad": "IV-A", "pregunta": "Define las 4 propiedades de las variables visuales: Asociativa, Selectiva, Ordenada, Cuantitativa.", "respuesta": "Asociativa: No altera la visibilidad/importancia. Selectiva: Permite agrupar en categorías. Ordenada: Permite representar un orden visual. Cuantitativa: Permite estimar cantidades/proporciones visualmente." },
          { "unidad": "IV-A", "pregunta": "¿Qué variables visuales NO presentan la propiedad Asociativa (es decir, son disociativas)?", "respuesta": "El Tamaño y el Valor (un tamaño mayor o un valor más oscuro destacan más)." },
          { "unidad": "IV-A", "pregunta": "¿Qué variable visual presenta más claramente la propiedad Selectiva?", "respuesta": "El Tono (color)." },
          { "unidad": "IV-A", "pregunta": "¿Qué variables visuales presentan la propiedad Ordenada?", "respuesta": "Posición, Valor, Tamaño y Textura (si las tramas varían ordenadamente)." },
          { "unidad": "IV-A", "pregunta": "¿Qué variables visuales presentan la propiedad Cuantitativa?", "respuesta": "Exclusivamente el Tamaño y la Posición." },
          { "unidad": "IV-A", "pregunta": "¿Se puede usar el Tono para representar orden? Explica.", "respuesta": "Según Bertin, no tiene la propiedad ordenada. Sin embargo, en la práctica sí se puede si se usa una secuencia de tonos con una lógica culturalmente aceptada (ej. azul-frío a rojo-cálido para temperatura)." },
          { "unidad": "IV-A", "pregunta": "¿Qué es un mapa?", "respuesta": "Una representación gráfica a escala, generalmente plana, de una parte de la superficie terrestre, mostrando la situación de objetos geográficos y considerando diversas condiciones (culturales, geofísicas, etc.)." },
          { "unidad": "IV-A", "pregunta": "Diferencia entre mapa, carta y plano.", "respuesta": "Mapa: Representación general a escala. Carta: Mapa con ayudas específicas para la navegación. Plano: Representación a escala muy grande (mucho detalle) de un área pequeña, usando técnicas topográficas." },
          { "unidad": "IV-A", "pregunta": "¿Qué es la Cartografía?", "respuesta": "El arte, ciencia y tecnología que intervienen en la elaboración de mapas y cartas." },
          { "unidad": "IV-A", "pregunta": "¿Cuáles son las 4 etapas del proceso cartográfico?", "respuesta": "1. Recoger datos. 2. Manipular y generalizar datos (diseñar y construir mapa). 3. Visualizar el mapa. 4. Interpretar la información." },
          { "unidad": "IV-A", "pregunta": "¿Qué es el diseño cartográfico?", "respuesta": "El conjunto de ideas y decisiones (simplificación, generalización, simbología) que toma el cartógrafo para crear un mapa efectivo." },
          { "unidad": "IV-A", "pregunta": "¿Por qué es importante considerar el propósito y el usuario al crear un mapa?", "respuesta": "Porque un mapa técnicamente correcto puede ser inútil si no se adapta a quién lo va a usar y para qué, eligiendo elementos (escala, proyección, tipo de mapa, simbología) y nivel de complejidad adecuados." },
          { "unidad": "IV-A", "pregunta": "Define Cartografía Base (o topográfica).", "respuesta": "Representa los principales elementos físicos de la superficie terrestre (vías, hidrografía, relieve, poblaciones) con precisión y localización. Objeto original de la cartografía." },
          { "unidad": "IV-A", "pregunta": "Define Cartografía Temática.", "respuesta": "Se centra en representar un tema o variable espacial concreta (física, social, política, etc.), usando la cartografía base como referencia geográfica." },
          { "unidad": "IV-A", "pregunta": "¿Cuáles son las dos partes diferenciadas de un mapa temático?", "respuesta": "1. Capa específica con la información temática. 2. Mapa base (con elementos de cartografía base simplificados) para dar localización geográfica." },
          { "unidad": "IV-A", "pregunta": "Diferencia entre información cualitativa y cuantitativa en cartografía temática.", "respuesta": "Cualitativa: Tipos nominal y alfanumérico (categorías sin orden inherente). Cuantitativa: Tipos ordinal, intervalos y razones (valores numéricos con orden o magnitud)." },
          { "unidad": "IV-A", "pregunta": "¿Qué variables visuales son adecuadas para información nominal/cualitativa?", "respuesta": "Forma (símbolos), Tono (colores distintos) o Textura. Se busca la propiedad selectiva." },
          { "unidad": "IV-A", "pregunta": "¿Qué variables visuales son adecuadas para información ordinal/cuantitativa?", "respuesta": "Valor (gama de claridad/oscuridad) o Tamaño. Se busca la propiedad ordenada (y cuantitativa para razones/intervalos, donde el Tamaño es ideal)." },
          { "unidad": "IV-A", "pregunta": "Enumera los elementos fundamentales que componen un mapa (layout).", "respuesta": "Título, Autor/Fuente, Canevás, Leyenda, Escala (numérica y gráfica), Norte, Localizador, (Opcional: Mapas de detalle, otra información)." },
          { "unidad": "IV-A", "pregunta": "¿Qué consideraciones hay sobre la leyenda en un mapa?", "respuesta": "Debe ser clara y fácil de interpretar. Evitar precisión innecesaria en rangos numéricos. No separarla del mapa con un cuadro si no es necesario." },
          { "unidad": "IV-A", "pregunta": "¿Qué elementos del mapa son menos necesarios en la visualización dinámica de un SIG?", "respuesta": "Autor, escala gráfica (hay herramientas de medida), canevás (mejor un localizador interactivo)." },
          { "unidad": "IV-A", "pregunta": "¿Cuál es la premisa fundamental al disponer los elementos en el lienzo del mapa?", "respuesta": "Maximizar la claridad y aprovechar óptimamente el espacio disponible, evitando zonas en blanco." },
          { "unidad": "IV-A", "pregunta": "¿Qué es el centro óptico de un mapa y dónde se sitúa?", "respuesta": "Es el punto focal visual del mapa, situado ligeramente por encima del centro geométrico (aprox. 5% de la altura)." },
          { "unidad": "IV-A", "pregunta": "¿Qué zonas del mapa tienen mayor importancia visual?", "respuesta": "La parte superior y la parte izquierda." },
          { "unidad": "IV-A", "pregunta": "¿Cuál es la dirección natural de la atención del lector en un mapa?", "respuesta": "Desde la esquina superior izquierda hasta la inferior derecha, pasando por el centro óptico." },
          { "unidad": "IV-A", "pregunta": "¿Qué factores influyen en el 'peso visual' de un elemento en el mapa?", "respuesta": "Posición (más peso a la derecha, arriba, lejos del centro), Tamaño (mayor tamaño, más peso), Color (brillantes, rojo>azul), Aislamiento, Forma (regulares, compactas), Dirección (si apuntan a otros)." },
          { "unidad": "IV-A", "pregunta": "Define mapa temático cuantitativo y cualitativo.", "respuesta": "Cuantitativo: Muestra información organizada o distribuciones numéricas. Cualitativo: Muestra información organizada en clases/categorías." },
          { "unidad": "IV-B", "pregunta": "¿Qué es el Catastro según el diccionario?", "respuesta": "Es el censo y padrón estadístico de los inmuebles/parcelas rústicas y urbanas, describiendo la propiedad inmobiliaria." },
          { "unidad": "IV-B", "pregunta": "Menciona algunas funciones del catastro.", "respuesta": "Captura/mantenimiento/suministro de info. de inmuebles y titulares; renovar inventario; regir información adecuada; administrar info. de edificaciones; proveer herramienta de recursos financieros." },
          { "unidad": "IV-B", "pregunta": "¿Cuáles son los dos enfoques del catastro como herramienta para la población?", "respuesta": "1. Permite a municipios obtener recursos para dar mejores servicios. 2. Proporciona seguridad sobre la propiedad privada." },
          { "unidad": "IV-B", "pregunta": "Enumera algunos usos principales de la información catastral (SIC).", "respuesta": "Fiscal (impuestos), reducción de procesos administrativos, reordenamiento urbano, manejo de información gráfica/alfanumérica de parcelas, base para registro de propiedad, diseño de infraestructuras, calidad de materiales constructivos." },
          { "unidad": "IV-B", "pregunta": "¿Cuál es la principal razón por la que la información catastral tiene poco uso más allá de ser cartografía base, a pesar de su disponibilidad?", "respuesta": "La dificultad técnica para explotar los datos, que requiere conocimientos sobre su estructura y qué información se puede extraer." },
          { "unidad": "IV-B", "pregunta": "¿Por qué un gobierno municipal debería tener un Sistema de Información Catastral moderno (digital)?", "respuesta": "Para integrar y sistematizar toda la información catastral, fortaleciendo sus dependencias y permitiendo una mejor gestión y toma de decisiones." },
          { "unidad": "IV-B", "pregunta": "¿Cómo ayudan los SIG al catastro?", "respuesta": "Permiten estructurar, visualizar y gestionar información espacialmente, asociando datos diversos al territorio, mejorando la planificación, la calidad del servicio y la eficiencia." },
          { "unidad": "IV-B", "pregunta": "¿Qué componentes integran la plena identificación catastral?", "respuesta": "La suma de información cartográfica (SIG) e información alfanumérica descriptiva (suelo, construcciones)." },
          { "unidad": "IV-B", "pregunta": "Menciona algunas explotaciones específicas de los datos catastrales usando SIG.", "respuesta": "Análisis físico (dimensiones, formas); análisis temporal (antigüedad edificios); análisis de usos del suelo (geomarketing); planeamiento urbanístico (alturas, edificabilidad, inventario suelo); demografía (estimación población por parcela)." },
          { "unidad": "IV-B", "pregunta": "¿Qué permite la construcción de modelos 3D catastrales?", "respuesta": "Inventariar la información catastral de los inmuebles con detalle tridimensional, garantizando la plena identificación en ciudades complejas." },
          { "unidad": "IV-B", "pregunta": "¿Cuál era la limitación de almacenar información catastral jurídica, económica y física solo en bases de datos alfanuméricas?", "respuesta": "La dificultad de relacionarla con el territorio donde se ubican los inmuebles." },
          { "unidad": "IV-B", "pregunta": "¿Qué beneficios aporta la integración de bases de datos geográficas (BDG) y alfanuméricas (BDA) en un SIG Catastral?", "respuesta": "Garantiza integridad, consistencia y veracidad de la información; permite cálculo automatizado de áreas; posibilita ubicación espacial y relación entre inmuebles." },
          { "unidad": "IV-B", "pregunta": "¿Por qué es fundamental registrar los cambios catastrales en el tiempo?", "respuesta": "Porque la dinámica inmobiliaria es constante y registrarla permite ver la evolución de los predios, analizarla en retrospectiva y tomar decisiones de planificación futuras." },
          { "unidad": "IV-B", "pregunta": "Describe las características de un Sistema de Información Catastral (SIC) moderno.", "respuesta": "Mantiene datos físicos/jurídicos/económicos; base de datos al servicio de titulares y administraciones; gestión informatizada; actualización constante (declaraciones, revisiones, notarías); responsabilidad de Gerencias Territoriales; colaboración con Adm. Locales; incluye subsistema de gestión alfanumérico y subsistema geográfico (SIG); conectado a BD Nacional." },
          { "unidad": "IV-B", "pregunta": "Define Escala Cartográfica.", "respuesta": "Es la relación entre las dimensiones de los objetos en el mapa y sus dimensiones reales en el terreno." },
          { "unidad": "IV-B", "pregunta": "¿Cómo se expresa matemáticamente la escala?", "respuesta": "1/E = Dm/Dt (donde E=Escala, Dm=Distancia mapa, Dt=Distancia terreno)." },
          { "unidad": "IV-B", "pregunta": "¿Qué es la Unidad Mínima Cartografiable (UMC)?", "respuesta": "El tamaño mínimo real que debe tener un objeto para poder ser representado en un mapa a una escala dada (o según el uso previsto)." },
          { "unidad": "IV-B", "pregunta": "¿Cuáles son las tres formas de expresar la escala en un mapa?", "respuesta": "Textual (ej. 'un cm representa 600 km'), Numérica (ej. 1:10,000), Gráfica (barra dividida)." },
          { "unidad": "IV-B", "pregunta": "¿Por qué es importante incluir siempre la escala gráfica en un mapa impreso?", "respuesta": "Porque si el mapa sufre cambios de tamaño (ampliación/reducción), la escala gráfica mantiene la proporción correcta, mientras que la numérica quedaría incorrecta." },
          { "unidad": "IV-B", "pregunta": "Explica qué significa una escala 1:20,000.", "respuesta": "Significa que 1 unidad de medida en el mapa representa 20,000 de esas mismas unidades en el terreno (ej. 1 cm en mapa = 20,000 cm en terreno)." },
          { "unidad": "IV-B", "pregunta": "En cartografía, ¿una escala 1:25,000 es mayor o menor que 1:50,000?", "respuesta": "1:25,000 es una escala MAYOR (muestra más detalle, menos área) que 1:50,000 (escala MENOR, muestra menos detalle, más área)." },
          { "unidad": "IV-B", "pregunta": "¿Qué es la generalización cartográfica y cuándo se aplica?", "respuesta": "Es la simplificación de la información al pasar a una escala menor (ej. de 1:25,000 a 1:50,000), eliminando o simplificando detalles según la nueva UMC." },
          { "unidad": "IV-B", "pregunta": "¿Qué ocurre si se amplía un mapa a una escala mayor que la original en un SIG?", "respuesta": "La precisión no aumenta, la visualización puede verse extraña (poca densidad de entidades, se ven vértices) porque no se añade nueva información." },
          { "unidad": "IV-B", "pregunta": "Define Escala de Análisis.", "respuesta": "Es el nivel o extensión espacial que se considera al estudiar un fenómeno geográfico. Afecta a la percepción de estructuras espaciales y a los resultados del análisis." },
          { "unidad": "IV-B", "pregunta": "¿Por qué la longitud medida de una costa o un camino puede variar según la 'vara de medir' (escala de análisis)?", "respuesta": "Porque una unidad de medida más pequeña captura más detalles (sinuosidades) de la línea, resultando en una longitud total mayor. La medida absoluta carece de sentido sin especificar la escala." },
          { "unidad": "IV-B", "pregunta": "¿Cómo afecta la resolución espacial (tamaño de celda) de un dato ráster a la escala de análisis?", "respuesta": "La resolución espacial condiciona la escala mínima de análisis. Detalles o variaciones más pequeños que el tamaño de celda no pueden ser capturados ni analizados." },
          { "unidad": "IV-B", "pregunta": "Define Precisión en el contexto de imágenes geográficas.", "respuesta": "Es la certeza con la que un objeto está ubicado en el terreno donde aparece en la imagen. Se expresa a menudo en píxeles (convertibles a metros según la resolución)." },
          { "unidad": "IV-B", "pregunta": "¿Qué relación existe entre resolución de imagen y escala topográfica típica?", "respuesta": "A mayor resolución (píxel más pequeño en metros), corresponde una escala topográfica mayor (más detalle). Ej: 1m res -> 1:2,000; 30m res -> 1:80,000." },
          { "unidad": "IV-B", "pregunta": "Menciona estrategias para controlar errores y mantener la precisión en un proyecto SIG.", "respuesta": "1. Usar datos de partida precisos y con calidad documentada (metadatos). 2. Minimizar la propagación de errores estructurando adecuadamente los procesos (operaciones más propensas al error al final)." },
          { "unidad": "IV-B", "pregunta": "Enumera ideas para evitar errores y pérdida de precisión en SIG.", "respuesta": "Evitar mezclar capas de orígenes/formatos dispares sin control; ser consciente de que precisión disminuye con resolución; la precisión final no supera la del dato menos preciso; menos capas en análisis = menos oportunidad de error." },
          { "unidad": "IV-B", "pregunta": "¿Por qué son importantes los metadatos en relación a la precisión?", "respuesta": "Porque documentan la calidad, origen y precisión de los datos SIG, información que a menudo se ignora pero es crucial para evaluar la fiabilidad de los resultados." },
          { "unidad": "IV-B", "pregunta": "¿Qué son las Proyecciones Cartográficas?", "respuesta": "Son transformaciones matemáticas para representar la superficie curva de la Tierra en un plano (mapa), introduciendo inevitablemente distorsiones (área, forma, distancia, ángulo)." },
          { "unidad": "IV-B", "pregunta": "¿Qué aspectos considerar al elegir una proyección?", "respuesta": "Tamaño del área (global vs local), localización (ecuador, polos, lat. medias), forma del área, propósito del mapa (conservar áreas, formas, distancias, etc.)." },
          { "unidad": "IV-B", "pregunta": "Diferencia entre Conversión y Transformación de coordenadas.", "respuesta": "Conversión: Entre sistemas con el mismo datum (exacta). Transformación: Entre sistemas con diferente datum (más compleja, puede no ser exacta)." },
          { "unidad": "IV-B", "pregunta": "¿Cómo manejan los SIG los diferentes sistemas de coordenadas?", "respuesta": "Incorporan funciones para cambiar coordenadas (conversión/transformación) o realizan transformaciones 'al vuelo' (en tiempo real) si los datos tienen definida su proyección original." }
        ];


        // --- Estado de la Aplicación ---
        let cards = []; // Array para almacenar las tarjetas con su estado
        let currentCardIndex = -1; // Índice de la tarjeta actual en la pila de estudio
        let studyPile = []; // Índices de las tarjetas a estudiar ('to_learn' y 'almost')
        let isFlipped = false; // Estado de si la tarjeta actual está volteada
        let currentView = 'study'; // Vista actual ('study', 'piles', 'all')

        // --- Elementos del DOM ---
        const cardContainer = document.getElementById('flashcard-container');
        const cardQuestion = document.getElementById('card-question');
        const cardAnswer = document.getElementById('card-answer');
        const progressCounter = document.getElementById('progress-counter');
        const studyCompleteMessage = document.getElementById('study-complete-message');

        const btnNotLearned = document.getElementById('btn-not-learned');
        const btnAlmost = document.getElementById('btn-almost');
        const btnLearned = document.getElementById('btn-learned');
        const btnResetProgress = document.getElementById('btn-reset-progress');

        const btnViewStudy = document.getElementById('btn-view-study');
        const btnViewPiles = document.getElementById('btn-view-piles');
        const btnViewAll = document.getElementById('btn-view-all');

        const viewStudy = document.getElementById('view-study');
        const viewPiles = document.getElementById('view-piles');
        const viewAll = document.getElementById('view-all');

        const pileToLearnCount = document.getElementById('pile-to-learn-count');
        const pileAlmostCount = document.getElementById('pile-almost-count');
        const pileLearnedCount = document.getElementById('pile-learned-count');
        const allCardsTableBody = document.getElementById('all-cards-table-body');

        // --- Funciones ---

        // Baraja un array (Algoritmo Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Intercambio de elementos
            }
        }

        // Guarda el estado actual de las tarjetas en Local Storage
        function saveState() {
            try {
                // Guardar solo los estados, no los datos completos
                const cardStates = cards.map(card => ({ id: card.id, status: card.status }));
                localStorage.setItem('flashcardsAppState', JSON.stringify(cardStates));
            } catch (e) {
                console.error("Error saving state to localStorage:", e);
            }
        }

        // Carga el estado de las tarjetas desde Local Storage o inicializa
        function loadState() {
            const savedStates = localStorage.getItem('flashcardsAppState');
            let states = {}; // Objeto para mapear id -> status
            if (savedStates) {
                try {
                    JSON.parse(savedStates).forEach(state => {
                        states[state.id] = state.status;
                    });
                } catch (e) {
                    console.error("Error parsing saved state:", e);
                    // Si hay error, se usarán los estados por defecto
                }
            }

            // Inicializar 'cards' combinando datos originales y estados guardados
            cards = flashcardsData.map((cardData, index) => ({
                ...cardData,
                id: index, // Usar índice como ID consistente
                status: states[index] || 'to_learn' // Estado guardado o 'to_learn'
            }));

            buildStudyPile();
            updateAllViews();
        }

        // Inicializa las tarjetas (resetea estados)
        function initializeCards() {
            cards.forEach(card => card.status = 'to_learn');
            saveState(); // Guardar el estado reseteado
        }

        // Construye la pila de estudio con tarjetas 'to_learn' y 'almost'
        function buildStudyPile() {
            studyPile = cards
                .filter(card => card.status === 'to_learn' || card.status === 'almost')
                .map(card => card.id); // Usar IDs
            shuffleArray(studyPile);
            currentCardIndex = studyPile.length > 0 ? 0 : -1;
        }

        // Muestra la tarjeta actual en la vista de estudio
        function displayCurrentCard() {
            isFlipped = false;
            cardContainer.classList.remove('flipped'); // Mostrar pregunta primero

            if (currentCardIndex !== -1 && currentCardIndex < studyPile.length) {
                const cardId = studyPile[currentCardIndex];
                const card = cards.find(c => c.id === cardId); // Encontrar por ID
                if (card) {
                    cardQuestion.textContent = card.pregunta;
                    cardAnswer.textContent = card.respuesta;
                    progressCounter.textContent = `Tarjeta ${currentCardIndex + 1} de ${studyPile.length}`;
                    studyCompleteMessage.classList.add('view-hidden');
                    // Habilitar botones
                    btnNotLearned.disabled = false;
                    btnAlmost.disabled = false;
                    btnLearned.disabled = false;
                    cardContainer.style.cursor = 'pointer';
                } else {
                    console.warn(`Card with ID ${cardId} not found.`);
                    moveToNextCard(); // Intentar saltar si no se encuentra
                }
            } else {
                // No hay más tarjetas
                cardQuestion.textContent = '';
                cardAnswer.textContent = '';
                progressCounter.textContent = 'Pila de estudio vacía';
                studyCompleteMessage.classList.remove('view-hidden');
                // Deshabilitar botones
                btnNotLearned.disabled = true;
                btnAlmost.disabled = true;
                btnLearned.disabled = true;
                 cardContainer.style.cursor = 'default';
            }
        }

        // Voltea la tarjeta actual
        function flipCard() {
             if (currentCardIndex !== -1 && currentCardIndex < studyPile.length) {
                isFlipped = !isFlipped;
                cardContainer.classList.toggle('flipped');
            }
        }

        // Actualiza el estado de la tarjeta actual y pasa a la siguiente
        function updateCardStatus(newStatus) {
            if (currentCardIndex !== -1 && currentCardIndex < studyPile.length) {
                const cardId = studyPile[currentCardIndex];
                const cardArrayIndex = cards.findIndex(c => c.id === cardId);

                if (cardArrayIndex !== -1) {
                    cards[cardArrayIndex].status = newStatus;
                    saveState();

                    // Lógica de avance
                    if (newStatus === 'learned') {
                         studyPile.splice(currentCardIndex, 1); // Quitar de la pila actual
                         // Si era la última, ajustar índice
                         if (currentCardIndex >= studyPile.length) {
                              currentCardIndex = studyPile.length > 0 ? 0 : -1;
                         }
                         // Si no, el índice actual ya apunta a la siguiente
                    } else {
                        // 'to_learn' o 'almost', pasar a la siguiente
                        currentCardIndex++;
                        // Si se acabó la pila, reconstruir y barajar
                        if (currentCardIndex >= studyPile.length) {
                             buildStudyPile();
                        }
                    }
                    updateAllViews(); // Actualizar interfaz
                } else {
                     console.error(`Could not find card with ID ${cardId} in main cards array.`);
                }
            }
        }

        // Mueve a la siguiente tarjeta (usado en caso de error)
        function moveToNextCard() {
             if (currentCardIndex !== -1) {
                 currentCardIndex++;
                 if (currentCardIndex >= studyPile.length) {
                     buildStudyPile();
                 }
                 displayCurrentCard();
             }
        }

        // Actualiza los contadores en la vista de pilas
        function updatePilesView() {
            pileToLearnCount.textContent = cards.filter(c => c.status === 'to_learn').length;
            pileAlmostCount.textContent = cards.filter(c => c.status === 'almost').length;
            pileLearnedCount.textContent = cards.filter(c => c.status === 'learned').length;
        }

        // Rellena la tabla en la vista de todas las tarjetas
        function updateAllCardsView() {
            allCardsTableBody.innerHTML = ''; // Limpiar tabla
            cards.forEach((card, index) => {
                const row = document.createElement('tr');
                let statusText = '';
                let statusClass = '';

                switch (card.status) {
                    case 'learned':
                        statusText = 'Aprendido';
                        statusClass = 'text-green-600 font-semibold';
                        break;
                    case 'almost':
                        statusText = 'Casi Aprendido';
                        statusClass = 'text-yellow-600 font-semibold';
                        break;
                    case 'to_learn':
                    default:
                        statusText = 'Por Aprender';
                        statusClass = 'text-red-600 font-semibold';
                        break;
                }

                row.innerHTML = `
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${index + 1}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">${card.unidad}</td>
                    <td class="px-4 py-2 text-sm text-gray-900">${card.pregunta}</td>
                    <td class="px-4 py-2 text-sm text-gray-500">${card.respuesta}</td>
                    <td class="px-4 py-2 whitespace-nowrap text-sm ${statusClass}">${statusText}</td>
                `;
                allCardsTableBody.appendChild(row);
            });
        }

        // Cambia la vista visible
        function switchView(viewToShow) {
            viewStudy.classList.add('view-hidden');
            viewPiles.classList.add('view-hidden');
            viewAll.classList.add('view-hidden');

            document.getElementById(`view-${viewToShow}`).classList.remove('view-hidden');
            currentView = viewToShow;

            // Resaltar botón de navegación activo
             btnViewStudy.classList.toggle('bg-blue-700', viewToShow === 'study');
             btnViewPiles.classList.toggle('bg-blue-700', viewToShow === 'piles');
             btnViewAll.classList.toggle('bg-blue-700', viewToShow === 'all');

            // Actualizar contenido de la vista si es necesario
            if (viewToShow === 'piles') {
                updatePilesView();
            } else if (viewToShow === 'all') {
                updateAllCardsView();
            } else if (viewToShow === 'study') {
                 // Si volvemos a estudiar y la pila estaba vacía, re-construir
                 if (currentCardIndex === -1 && cards.some(c => c.status === 'to_learn' || c.status === 'almost')) {
                     buildStudyPile();
                 }
                 displayCurrentCard(); // Asegurarse de mostrar la tarjeta correcta
            }
        }

        // Actualiza todas las vistas (contadores y tarjeta actual)
         function updateAllViews() {
             updatePilesView(); // Siempre actualiza contadores
             if (currentView === 'study') {
                 displayCurrentCard(); // Actualiza la tarjeta si estamos en la vista de estudio
             } else if (currentView === 'all') {
                 updateAllCardsView(); // Actualiza la tabla si estamos en esa vista
             }
         }

        // Reinicia el progreso de todas las tarjetas
        function resetProgress() {
            if (confirm("¿Estás seguro de que quieres reiniciar todo tu progreso? Todas las tarjetas volverán a 'Por Aprender'.")) {
                initializeCards(); // Reinicializa los estados
                buildStudyPile();
                updateAllViews();
                 switchView('study'); // Cambiar a la vista de estudio
            }
        }

        // --- Event Listeners ---
        cardContainer.addEventListener('click', flipCard);

        btnNotLearned.addEventListener('click', () => updateCardStatus('to_learn'));
        btnAlmost.addEventListener('click', () => updateCardStatus('almost'));
        btnLearned.addEventListener('click', () => updateCardStatus('learned'));
        btnResetProgress.addEventListener('click', resetProgress);

        btnViewStudy.addEventListener('click', () => switchView('study'));
        btnViewPiles.addEventListener('click', () => switchView('piles'));
        btnViewAll.addEventListener('click', () => switchView('all'));

        // --- Inicialización ---
        document.addEventListener('DOMContentLoaded', () => {
            loadState(); // Cargar estado al iniciar (ahora combina datos embebidos y estados de LS)
            switchView('study'); // Mostrar vista de estudio por defecto
        });

    </script>

</body>
</html>
